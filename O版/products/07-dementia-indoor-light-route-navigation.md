# 产品07：失智老人室内光路导航系统（详细设计实现文档）

## 0. 文档信息
- 版本：v1.0
- 适用对象：阿尔茨海默早中期家庭
- 目标：减少夜间迷失和误入高风险区域

## 1. 建设目标
1. 提供无穿戴的室内动态引导。
2. 降低夜间迷路引发的冲突和惊扰。
3. 在“提醒强度”和“自主性”之间平衡。

## 2. 范围边界
- **In Scope**：路径引导、误入阻断、时段场景。
- **Out of Scope**：精确医疗定位、院内监护系统替代。

## 3. 功能需求
### Must
- FR-01：支持厕所/卧室/餐桌三类高频目的地。
- FR-02：地脚灯动态引导与到达后自动熄灯。
- FR-03：危险区域误入提醒。

### Should
- FR-04：夜间柔光模式、白天低干扰模式。
- FR-05：照护计划联动（如厕训练）。

### Could
- FR-06：可选UWB增强定位精度。

## 4. 非功能指标
- 导航响应时延 < 1s。
- 夜间干预成功率 > 85%。
- 光照舒适度达适老标准。
- 离线可运行。

## 5. 系统架构
```text
区域传感(门磁/存在感知/UWB可选)
   -> 边缘决策网关(迷失检测+路径规划)
      -> 可寻址灯带 + 语音锚点
         -> 家属配置App
```

## 6. 硬件设计
- 可寻址地脚灯带：支持渐亮、渐隐、方向流动效果。
- 门磁与区域传感：低成本部署关键门口点位。
- 可选UWB锚点：复杂户型提升定位稳定性。

## 7. 软件模块
1. `WanderingDetector`：回游/停滞/反复转向检测。
2. `RoutePlanner`：最短安全路径计算。
3. `LightSceneEngine`：灯光编排与时段策略。
4. `GuardianAppService`：家属配置与回放。

## 8. 数据模型
- `ZoneTransition { from, to, ts }`
- `WanderingEvent { duration, loops, severity }`
- `GuidanceSession { target, start_ts, end_ts, success }`

## 9. 算法策略
- 迷失模式判定：单位时间内回游次数 + 非目标停留时长。
- 引导策略：短路径优先，避开黑暗/湿滑区域。
- 渐隐策略：达目标后弱化提示，避免形成过度依赖。

## 10. 接口定义
- `POST /api/v1/navigation/scene/start`
- `GET /api/v1/navigation/session/history`
- `POST /api/v1/navigation/rule/update`

## 11. 交互流程
1. 触发“找厕所”或系统识别迷失模式。
2. 灯带按方向渐进引导。
3. 到达目标区域后自动熄灯并记录结果。

异常流程：
- 连续引导失败 -> 推送家属/护理员协助。

## 12. 安全与合规
- 定位数据默认本地保存，周期清理。
- 夜间音量上限控制。
- 系统不做人格化干预，仅提供路径辅助。

## 13. 测试与验收
- 户型覆盖测试：一居/两居/复式。
- 夜间场景测试：弱光、停电恢复、访客干扰。
- 指标：夜间迷失事件下降 > 30%。

## 14. 实施计划
- P1：单层住宅模板化安装。
- P2：多层与复杂户型优化。
- P3：社区照护计划联动。

## 15. 风险与缓解
- 风险：提示过多导致烦躁。  
  缓解：分时段策略 + 提醒节流。
- 风险：家属误用为监控工具。  
  缓解：默认最小数据可见 + 透明告知。
