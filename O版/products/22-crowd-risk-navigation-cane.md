# 产品22：公共空间拥挤风险导航手杖（详细设计实现文档）

## 0. 文档信息
- 版本：v1.0
- 目标对象：行动缓慢、平衡能力弱老人
- 目标：提供“舒适安全路线”与可触达转向引导

## 1. 建设目标
1. 路径规划从“最短路”升级为“低拥挤低坡度低风险”。
2. 手杖与手机协同，降低视觉依赖。
3. 提供紧急求助与家属临时追踪能力。

## 2. 范围边界
- **In Scope**：导航、震动引导、拥挤规避、SOS。
- **Out of Scope**：全天候定位监控、医疗诊断。

## 3. 功能需求
### Must
- FR-01：舒适路线规划。
- FR-02：左右震动转向提示。
- FR-03：跌倒/求助一键上报。

### Should
- FR-04：天气湿滑与路面风险提示。
- FR-05：家属临时位置共享。

### Could
- FR-06：结伴出行匹配。

## 4. 非功能指标
- 路线偏离率 < 10%。
- 室外续航 >= 24h。
- 防水防摔达到日常户外要求。

## 5. 总体架构
```text
智能手杖(IMU/震动/SOS)
   <-> 手机App(定位/导航)
      <-> 城市开放数据(拥挤/坡度/施工)
         -> 家属端临时追踪
```

## 6. 硬件设计
- IMU：检测步态与手杖姿态。
- 震动马达：左右分向反馈。
- SOS按键：长按触发求助。
- 通信模块：BLE与手机联动。

## 7. 软件模块
1. `ComfortRoutePlanner`：多目标路径规划。
2. `HapticNavigator`：震动指令编排。
3. `RiskMapUpdater`：拥挤与天气风险融合。
4. `GuardianShareService`：临时共享管理。

## 8. 数据模型
- `RouteCandidate { path_id, distance, crowd_score, slope_score }`
- `ComfortScore { total, dimensions[] }`
- `NavHapticCommand { direction, intensity, duration }`
- `SosEvent { ts, location, status }`

## 9. 算法策略
- 目标函数：`min(拥挤 + 坡度 + 风险) + 距离约束`。
- 路径重算触发：前方拥挤突增、封路、天气变化。
- 震动编码：左转/右转/到达采用不同节奏。

## 10. 接口定义
- `POST /api/v1/nav/plan`
- `POST /api/v1/nav/replan`
- `POST /api/v1/sos/trigger`
- `POST /api/v1/share/temp-link`

## 11. 交互流程
1. 输入目的地，生成舒适路线。
2. 行进中通过手杖震动引导转向。
3. 风险升高自动重规划并语音提醒。
4. 紧急时一键SOS并共享位置。

## 12. 安全与合规
- 位置共享默认临时授权并自动失效。
- 不做后台持续追踪。
- 提供离线地图包保障弱网场景。

## 13. 测试与验收
- 医院/地铁/菜场高拥挤路线实测。
- 震动提示可理解性测试。
- 验收：求助到达率>99%，偏离率<10%。

## 14. 实施计划
- P1：医院周边线路先行。
- P2：核心商圈与地铁站点扩展。
- P3：城市无障碍平台联动。

## 15. 风险与缓解
- 风险：实时拥挤数据缺失。  
  缓解：历史预测 + 众包补偿。
