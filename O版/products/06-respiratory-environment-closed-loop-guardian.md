# 产品06：呼吸-环境闭环守护系统（详细设计实现文档）

## 0. 文档信息
- 文档版本：v1.0
- 目标人群：COPD、心衰、呼吸脆弱老人
- 场景重点：夜间与季节交替期的急性加重预防

## 1. 建设目标与范围
### 1.1 目标
1. 将环境控制从“固定策略”升级为“个体呼吸负荷驱动”。
2. 降低夜间呼吸不适与急性加重风险。
3. 形成家庭-社区医生可协同的数据闭环。

### 1.2 边界
- **In Scope**：呼吸状态监测、空调新风联动、风险提醒。
- **Out of Scope**：处方调整、临床治疗替代。

## 2. 功能需求
### Must
- FR-01：非接触呼吸节律与负荷监测。
- FR-02：温湿度/CO2/PM/VOC联动调控。
- FR-03：恶化趋势分级告警。

### Should
- FR-04：吸入器用药提醒协同。
- FR-05：医生端摘要看板。

### Could
- FR-06：天气预测驱动的前瞻调控。

## 3. 非功能指标
- 本地控制周期：<= 60s。
- 夜间告警延迟：< 5s。
- 系统可用性：>= 99.5%。
- 断网可运行：>= 72h。

## 4. 总体架构
```text
呼吸雷达 + 环境传感器
   -> 边缘控制器(RLI计算+MPC控制)
      -> 空调/新风/加湿执行器
         -> App/医生端摘要
```

## 5. 硬件设计
- 毫米波呼吸雷达：床旁非接触部署。
- CO2/PM/VOC温湿传感器：环境多点采样。
- 智能执行器：空调、新风、加湿器协议适配。
- 备用供电：关键链路断电保护。

## 6. 软件模块
1. `RespiratoryMonitor`：呼吸节律与异常检测。
2. `RLIEngine`：呼吸负荷指数计算。
3. `EnvController`：MPC闭环控制。
4. `RiskAlertService`：分级告警与建议。
5. `DeviceAdapter`：多品牌家电协议兼容。

## 7. 数据模型
- `RLIStream { ts, rli, confidence }`
- `EnvSnapshot { temp, hum, co2, pm25, voc }`
- `ControlAction { device, target, reason }`
- `ExacerbationAlert { level, triggers, suggestion }`

## 8. 算法设计
### 8.1 RLI计算
融合以下特征：
- 呼吸频率偏移
- 呼吸波动稳定性
- 夜间体动关联
- 环境刺激负荷

### 8.2 控制策略
- 采用MPC在舒适性与健康风险间求解最优控制。
- 当RLI持续高位时优先改善空气质量与温湿条件。

## 9. 接口定义
- `GET /api/v1/rli/latest`
- `POST /api/v1/env/control/override`
- `GET /api/v1/resp/night-report`
- `POST /api/v1/doctor/summary/export`

## 10. 交互流程
1. 夜间开始自动监测。
2. RLI上升触发环境自调。
3. 连续异常时提醒吸入治疗与休息。
4. 次日生成摘要推送。

异常流程：
- 执行器离线时进入降级策略：仅监测+告警，不自动控制。

## 11. 安全与合规
- 本地优先处理，云端仅同步指标。
- 用户可随时手动接管控制。
- 固定声明：本系统为辅助管理，不替代医生建议。

## 12. 测试与验收
- 控制链路稳定性测试（多品牌家电）。
- 环境扰动测试（开窗、多人同室、天气突变）。
- 试点观察指标：夜间不适事件下降>25%。

## 13. 实施计划
- Phase1：夜间场景MVP（8周）。
- Phase2：全天策略扩展（16周）。
- Phase3：社区医生协作平台接入（24周）。

## 14. 风险与缓解
- 风险：家电协议碎片化。  
  缓解：协议适配层 + 白名单认证。
- 风险：过度调控引发不适。  
  缓解：舒适度约束 + 用户偏好学习。
