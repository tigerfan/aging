# 产品17：社区照护协同电子门牌（详细设计实现文档）

## 0. 文档信息
- 版本：v1.0
- 目标：打通“最后十米到户服务协同”
- 使用方：老人家庭、服务商、社区管理方

## 1. 建设目标
1. 统一上门服务状态展示与签到。
2. 降低漏服务、错时服务与沟通成本。
3. 为社区提供可量化SLA治理能力。

## 2. 范围边界
- **In Scope**：工单流转、到户签到、异常升级、求助触发。
- **Out of Scope**：医疗诊断系统、家庭监控系统。

## 3. 功能需求
### Must
- FR-01：门牌显示任务状态（待上门/进行中/完成）。
- FR-02：NFC签到与服务留痕。
- FR-03：异常上报与自动升级。

### Should
- FR-04：访客权限管理。
- FR-05：服务时效SLA看板。

### Could
- FR-06：社区活动报名入口。

## 4. 非功能指标
- 离线缓存>=72h。
- 工单状态同步时延<3s。
- 设备防拆报警准确率>99%。

## 5. 总体架构
```text
电子门牌终端(墨水屏+NFC+门磁)
   -> 护理调度平台
      -> 服务商App + 社区监管后台
```

## 6. 硬件设计
- 电子墨水屏：低功耗常显。
- NFC模块：到户签到与身份校验。
- 门磁与防拆开关：异常检测。
- 低功耗通信：保障长续航。

## 7. 软件模块
1. `OrderStateMachine`：工单状态流转。
2. `CheckInVerifier`：NFC签到校验。
3. `SlaMonitor`：超时检测与升级。
4. `EmergencyButtonService`：一键求助链路。
5. `TenantPolicy`：多服务商权限隔离。

## 8. 数据模型
- `ServiceOrder { id, type, assignee, status, due_time }`
- `NfcCheckIn { order_id, worker_id, ts, location_hash }`
- `SlaViolation { order_id, overdue_sec, level }`
- `EscalationEvent { target, reason, action }`

## 9. 策略设计
- SLA分层：普通任务、关键任务、紧急任务。
- 升级链路：服务商 -> 社区管理员 -> 备用服务商。
- 显示策略：门牌仅展示最小必要信息。

## 10. 接口定义
- `POST /api/v1/order/dispatch`
- `POST /api/v1/order/checkin`
- `POST /api/v1/order/complete`
- `POST /api/v1/order/escalate`

## 11. 交互流程
1. 平台下发工单到服务商。
2. 上门后NFC签到，门牌更新“进行中”。
3. 完成后回传结果并归档。
4. 超时自动升级并通知相关方。

## 12. 安全与合规
- 病史等敏感信息不在门牌展示。
- 数据访问全程审计。
- 支持授权撤回与设备解绑。

## 13. 测试与验收
- 多服务商并发工单测试。
- 断网断电恢复测试。
- 验收：漏服务率下降>50%，准时率提升>20%。

## 14. 实施计划
- 阶段1：5个社区试点。
- 阶段2：城市级平台对接。
- 阶段3：跨区域标准化复制。

## 15. 风险与缓解
- 风险：服务商系统标准不一。  
  缓解：统一数据接口规范与适配层。
- 风险：老人担心信息暴露。  
  缓解：最小显示策略 + 可见权限配置。
