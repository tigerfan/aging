# 产品02：药食冲突智能厨房中枢（详细设计实现文档）

## 0. 文档信息
- 文档版本：v1.0
- 适用场景：家庭慢病照护厨房、社区助餐点
- 目标：把“提醒吃药”升级为“情境化药食冲突决策”

## 1. 建设目标与边界
### 1.1 业务目标
1. 识别高风险药食冲突并实时阻断。
2. 为照护者提供可执行替代方案（食材/时间调整）。
3. 减少因信息分散导致的不良用药行为。

### 1.2 范围边界
- **In Scope**：处方同步、药品识别、食材识别、冲突推理、建议输出。
- **Out of Scope**：处方开具、医疗诊断、急诊处理。

## 2. 用户角色
- 老人用户：多病共存且长期服药。
- 照护者：负责买菜做饭与用药提醒。
- 药师/医生：提供规则审校与复核建议。

## 3. 功能规格
### 3.1 Must
- FR-01：识别药盒与药品信息（NFC/OCR）。
- FR-02：识别食材与烹饪准备动作。
- FR-03：结合时间窗判定冲突等级并给替代建议。

### 3.2 Should
- FR-04：处方同步（医院/互联网医院）。
- FR-05：冲突事件留痕与可追溯解释。

### 3.3 Could
- FR-06：语音烹饪指引与备餐计划。

## 4. 非功能指标
- 冲突识别召回率：高风险项 >= 98%。
- 结果解释率：100%（必须附来源）。
- 推理时延：< 1.5s（边缘侧）。
- 数据安全：医疗数据加密存储，最小可见原则。

## 5. 总体架构
```text
RGBD台面相机 + 电子秤 + NFC药盒
    -> 边缘AI盒(识别 + 规则推理)
        -> 云端药理知识图谱/规则中心
            -> 家庭终端App + 药师复核端
```

## 6. 硬件设计
- 视觉模组：RGBD 1080p，70°视场角。
- 称重模组：精度1g，支持食材混合称量。
- NFC读取器：兼容标准药盒标签。
- 麦克风阵列：语音交互与免手输入。

## 7. 软件模块
1. `PrescriptionSync`：处方数据同步与标准化。
2. `DrugRecognizer`：NFC优先，OCR兜底。
3. `FoodVisionEngine`：食材识别与置信度融合。
4. `ConflictReasoner`：基于知识图谱 + 规则引擎。
5. `SuggestionPlanner`：替代食材、服药时间重排。
6. `AuditTrailService`：证据链记录。

## 8. 数据模型
- `MedicationProfile { drug_code, dose, freq, timing_window }`
- `FoodItem { sku, nutrient_tags, recognition_confidence }`
- `ConflictDecision { level, reason_codes, evidence_refs, alternatives }`

数据分级：
- P1：处方与病种限制（高敏）
- P2：冲突事件摘要
- P3：匿名模型反馈样本

## 9. 算法与规则策略
### 9.1 识别融合
- 药品：NFC命中直接确认；未命中走OCR + 药品词典匹配。
- 食材：视觉Top-3候选与电子秤上下文重排。

### 9.2 冲突推理
- 规则优先（强约束）：禁忌组合直接拦截。
- 图谱推理（弱约束）：潜在风险给概率评级。
- 时间窗策略：`T-1h ~ T+2h`按药物类型动态调整。

## 10. 接口定义
- `POST /api/v1/rx/sync`
- `POST /api/v1/conflict/evaluate`
- `GET /api/v1/suggestion/generate`
- `POST /api/v1/feedback/false-positive`

返回结构包含：`risk_level`、`reason`、`evidence_url`、`action_plan`。

## 11. 交互流程
1. 用户放置药盒与食材。
2. 系统识别并显示冲突等级。
3. 若高风险，给出“替代食材 + 服药改时”双方案。
4. 用户确认执行，系统记录“采纳/忽略”用于后续优化。

异常流程：
- 识别置信度低时，触发人机确认（不直接输出高风险结论）。

## 12. 安全与合规
- 建议必须附来源（指南、药典、药师审核版本）。
- 默认本地识别，云端仅上传匿名冲突摘要。
- 任何建议文案包含免责声明：不替代医生个体处方。

## 13. 测试与验收
- 识别测试：100种常见药盒、200类食材。
- 规则测试：20类高风险冲突全覆盖。
- 回归测试：规则热更新后核心冲突不退化。

验收门槛：
- 高风险冲突漏检率 < 1%。
- 建议执行完成率 >= 70%。

## 14. 实施计划
- P1（0~6周）：20类冲突MVP。
- P2（7~12周）：处方同步 + 证据链。
- P3（13~20周）：药师复核平台与规模部署。

## 15. 风险与缓解
- 风险：食材识别误差引发误提醒。  
  缓解：多模态融合 + 用户确认。
- 风险：规则冲突（新旧版本）。  
  缓解：灰度发布 + 一键回滚。
- 风险：过度提醒影响体验。  
  缓解：分级提醒 + 个体偏好学习。
