# 产品13：应急药盒-城市急救联动系统（详细设计实现文档）

## 0. 文档信息
- 版本：v1.0
- 目标：缩短“症状出现 -> 急救响应”时间
- 适用对象：心绞痛、哮喘、严重过敏等高风险老人

## 1. 建设目标
1. 在家庭端快速触发标准化急救流程。
2. 联动家属与急救平台形成协同链路。
3. 对全过程进行可追溯复盘。

## 2. 边界
- **In Scope**：应急触发、语音指导、定位共享、急救通知。
- **Out of Scope**：医院内急救调度替代、诊断决策替代。

## 3. 功能需求
### Must
- FR-01：一键急救触发。
- FR-02：分症状语音剧本指导。
- FR-03：自动通知家属与急救端并共享定位。

### Should
- FR-04：药物取用记录与事后复盘。
- FR-05：有效期与补给提醒。

### Could
- FR-06：与可穿戴生命体征联动。

## 4. 非功能指标
- 应急触发到通知发出 < 5s。
- 紧急模式可用性 >= 99.9%。
- 误触发率 < 2%。

## 5. 总体架构
```text
应急药盒终端(分仓锁控/语音/定位)
   -> 家庭网关
      -> 急救平台接口 + 家属协同App
         -> 事件审计与复盘系统
```

## 6. 硬件设计
- 分仓锁控：按场景控制可取药仓位。
- 语音播报模块：大音量分步骤指导。
- 定位模块：室内外定位融合。
- 应急电池：断电下持续工作。

## 7. 软件模块
1. `EmergencyTrigger`：紧急触发与去抖动。
2. `SymptomTriage`：问答分级策略。
3. `GuidanceScriptEngine`：剧本化语音引导。
4. `ContactChainService`：通知链路与重试。
5. `AuditTimeline`：过程留痕。

## 8. 数据模型
- `EmergencyCase { id, trigger_ts, symptom_type, level }`
- `MedicationTakeRecord { compartment, ts, confirmed }`
- `ResponseTimeline { notify_ts, ack_ts, arrival_eta }`

## 9. 策略设计
- 一级触发：立即播报 + 家属通知。
- 二级触发：并行通知急救端。
- 二次确认：非危急模式下可启用，危急模式可跳过。

## 10. 接口定义
- `POST /api/v1/emergency/trigger`
- `POST /api/v1/emergency/triage`
- `POST /api/v1/emergency/notify`
- `GET /api/v1/emergency/timeline/{case_id}`

## 11. 交互流程
1. 用户按下急救键。
2. 设备语音引导用药和体位。
3. 自动通知家属和急救资源。
4. 事件结束后生成复盘报告。

异常流程：
- 未接通任一联系人时，自动扩展通知链路（邻里/社区）。

## 12. 安全与合规
- 紧急数据最小披露，事后审计可追溯。
- 设备防误触设计（防滑盖/长按机制）。
- 明确非急症场景使用边界。

## 13. 测试与验收
- 端到端压测（高峰时段并发告警）。
- 语音引导可理解性测试。
- 验收：中位响应时间缩短 > 20%。

## 14. 实施计划
- P1：家庭单机版。
- P2：社区急救联动试点。
- P3：城市平台标准接口对接。

## 15. 风险与缓解
- 风险：非急症误触发。  
  缓解：二次确认 + 问答复核。
- 风险：联系人链路不稳定。  
  缓解：多通道通知与重试机制。
