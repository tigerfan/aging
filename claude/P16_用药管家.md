# P16 用药管家——AI智能药盒与用药依从性系统

---

## A. 需求分析文档

### 1. 产品概述与定位

**用药管家**是一款融合AI药物识别、自动分药、声光提醒、服药确认和家属监督的全流程智能用药管理系统。老年人普遍患有多种慢性病，平均日服药4–8种，漏服、误服、重复服药极为常见。本产品通过CV药物识别和RFID处方追踪，在家庭场景中提供接近药师级别的用药安全保障，同时将用药依从性数据推送给家属和医生，形成完整的慢病用药闭环管理。

**蓝海点**：市面上智能药盒多为简单定时提醒，无药物识别能力；专业自动分药机仅在医院药房使用，价格昂贵；面向家庭老年患者的AI识别+依从性管理系统市场空白。

### 2. 目标用户画像

| 维度 | 描述 |
|------|------|
| 核心用户 | 65–85岁，患有3种以上慢性病，独居或日间独处的老年人 |
| 次要用户 | 帕金森、阿尔茨海默症早期患者（用药复杂，记忆力下降） |
| 家属 | 子女不在身边，担心父母漏服或误服药物 |
| 使用场景 | 每日多次用药提醒、每周整理一次药盒 |
| 药物复杂度 | 日服药4–8种，部分需餐前/餐后/睡前分次服用 |

### 3. 市场痛点与机会

- 全球老年人慢性病用药不依从率高达50%，导致病情控制差和高住院率
- 药物相互作用是老年人不良反应主要原因之一，家庭层面几乎无识别能力
- 现有智能药盒（如Pillsy）：仅定时提醒，不能识别药物种类，无法防止误服
- 专业分药设备（如Parata）：价格10万元以上，仅适用于机构
- 家属/护工人工监督：耗时耗力，信息记录不完整

### 4. 功能性需求（FR）

**FR-01 药物识别与入库**
- 摄像头扫描药物：识别药品盒上的条形码/二维码自动导入处方信息
- AI图像识别：对未贴标签散装药片，按形状+颜色+压印识别药物种类（1,000种以上常用药库）
- 药物数据库：药品名称、规格、适应症、用法用量、常见副作用、相互作用警示

**FR-02 自动分药（机械模块）**
- 7格×4时段（一周28格）自动分药网格抽屉
- 机器人臂辅助分药提醒：在装药时，系统根据处方引导用户每格放入正确药物
- 可选升级版：全自动分药机（震动+电磁阀，自动按格分发）

**FR-03 智能提醒**
- 多级提醒：声音（60dB语音播报）+ LED彩灯（对应药格亮灯）+ 手机推送
- 提醒内容："现在是早上8点，请服用降压药和血糖药，共3粒，饭后服"
- 未服药确认机制：15分钟后未取药，升级提醒强度；30分钟后通知家属

**FR-04 服药确认**
- 重量传感器：每格药盒底部，药物取出时重量变化>阈值确认取药
- 可选补充确认：口服镜头（小型摄像头检测老人是否实际吞服，非强制功能，需老人授权）
- 手机确认：老人点击APP"已服药"按钮（双重确认）

**FR-05 药物安全保障**
- 药物相互作用检测：处方录入时自动检查，发现严重相互作用立即警示
- 重复用药警告：检测到重复录入相同成分药物，提醒确认
- 过期药预警：记录药品有效期，提前30天提醒更换

**FR-06 依从性报告**
- 每日/每周/每月用药依从率统计
- 漏服记录：哪天哪次漏服，漏服哪种药
- 家属APP：实时推送服药状态，漏服立即通知
- 医生端：月度依从性报告（HL7 FHIR格式），辅助门诊调整处方

### 5. 非功能性需求（NFR）

| 维度 | 指标 |
|------|------|
| 药物识别准确率 | 条码/二维码识别≥99.9%，图像识别≥92% |
| 重量传感器精度 | 最小药片感知（≥0.05g变化可检测） |
| 提醒声音 | ≥65dB（适合老年人轻度听力下降） |
| 电源 | 市电+锂电备用（停电继续工作6小时） |
| 网络依赖 | 基础提醒功能离线可用（WiFi断开继续提醒） |
| 显示 | 主机3.5英寸彩色液晶，字体≥24pt |

### 6. 约束条件与合规要求

- 药物识别库须与国家药品监督管理局药品数据库对接，保持每月更新
- 自动分药功能不作为"医疗设备"，定位为"用药辅助管理工具"
- 摄像头服药确认功能必须用户明确授权，数据不上传云端（本地处理）
- 药物相互作用数据库须有专业药师审核，提供免责声明

---

## B. 详细设计方案

### 1. 系统架构

```
[用药管家主机]
     ├── 7×4格药盒抽屉（含重量传感器）
     ├── 摄像头（药物识别）
     ├── LED指示灯阵列（对应每格）
     ├── 扬声器（语音提醒）
     ├── 3.5寸触控显示屏
     ├── 主控SBC（Raspberry Pi Zero 2W等效）
     └── WiFi + BLE
          │ WiFi
          ▼
[手机APP（老人端 + 家属端）]
     ├── 用药计划管理
     ├── 实时服药状态
     ├── 药物数据库查询
     └── 依从性报告
          ▼
[云端服务]
     ├── 药物知识库（国家药品数据库镜像）
     ├── 药物相互作用检测引擎
     ├── 处方管理
     └── 医生随访平台
```

### 2. 硬件设计方案

**2.1 药盒结构**
- 7天×4时段（早/中/晚/睡前）= 28格，每格尺寸40×40×25mm
- 每格重量传感器：HX711+应变片（0.01g分辨率），检测药物取出
- 每格LED：RGB LED（红=未服，绿=已服，黄=提醒时刻，蓝=信息提示）
- 抽屉设计：每格独立抽屉，到提醒时间自动弹出（弹出机构选配）

**2.2 识别摄像头**
- 摄像头：200万像素，配合导光板（药品识别拍摄台），均匀光照
- 扫码：支持1D/2D条码，识别响应<1秒
- AI识别：边缘运行MobileNetV3模型（INT8量化，推理<200ms），识别散装药片

**2.3 主控与显示**
- 主控：Raspberry Pi Zero 2W（1GHz四核，512MB RAM，足够运行边缘AI推理）
- 显示：3.5英寸IPS触控屏（320×480），大图标界面，字体≥24pt
- 音响：5W扬声器，TTS语音合成（讯飞语音本地离线版），支持普通话+方言

### 3. 软件设计方案

**3.1 药物识别引擎**
```python
def identify_drug(image):
    # 步骤1：尝试条码/二维码识别（速度快，准确率极高）
    barcode = scan_barcode(image)
    if barcode:
        return lookup_drug_by_barcode(barcode)
    
    # 步骤2：AI图像识别（散装药片）
    features = mobilenet_v3.extract_features(preprocess(image))
    top5_drugs = drug_classifier.predict_top5(features)
    
    # 步骤3：形状+颜色+压印辅助验证
    shape = detect_shape(image)   # 圆形/椭圆/长方形等
    color = detect_color(image)   # 主色调
    imprint = ocr_imprint(image)  # 压印文字/数字
    
    matched = filter_by_attributes(top5_drugs, shape, color, imprint)
    return matched[0] if confidence > 0.85 else "请手动确认"
```

**3.2 提醒系统**
```
每日提醒调度器（Cron触发）：
提醒时间到 →
    LED阵列：当前时段所有格子黄色闪烁
    扬声器：播放TTS语音提醒（药名+数量+服法）
    手机推送：发送服药提醒
    
等待15分钟：
    重量传感器：检测各格药物是否被取出
    已取出格：LED变绿，记录"已服药"
    未取出格：提醒升级（更大声音+持续闪烁）
    
等待30分钟仍未服：
    通知家属APP（"爸爸的早餐降压药还未服用"）
```

**3.3 药物相互作用引擎**
- 数据源：DrugBank开源数据库 + 国家药典相互作用数据
- 检测级别：Major（严重，禁止联用）/ Moderate（中等，需监测）/ Minor（轻微，告知）
- 检测时机：处方录入时、修改处方时
- 严重级别：弹出全屏警告，要求家属/医生确认后才能录入

### 4. 用户交互设计

**老人端（主机操作，极简）**
```
按下主机顶部大按钮 → 语音播放今日用药计划
LED亮灯 → 取出对应格药物 → 吞服
按确认键（或自动重量检测）→ LED变绿，记录完成
```

**家属端APP**
- 首页：今日用药状态（实时仪表盘，红/黄/绿颜色标示）
- 历史：30天依从率日历（绿=全服，黄=部分漏服，红=严重漏服）
- 处方管理：远程添加/修改药物（需医生授权码）
- 告警：漏服推送、药品即将用完提醒、药品过期提醒

### 5. 商业化路径与技术风险

**商业化路径**
- **硬件**：基础版（定时提醒+重量传感）1,200元；高级版（摄像头AI识别+弹出机构）2,400元
- **增值服务**：99元/年（云端药物库更新+家属无限设备监控）
- **B端**：养老院批量配置，护理管理平台集成（可对接医院HIS系统）
- **医保合作**：慢病管理服务包，药房处方系统直接推送至设备

**技术风险评估**

| 风险 | 等级 | 应对措施 |
|------|------|----------|
| 散装药片识别准确率不足 | 高 | 前期聚焦条码识别（高准确），图像识别作为辅助+人工确认 |
| 老人操作复杂（摄像头拍药） | 中 | 设计固定拍摄台，放置即自动拍摄，无需任何操作 |
| 重量传感器误触（振动/摇晃） | 中 | 去抖动算法，重量变化需持续>2秒才计为取药 |
| 药物数据库更新不及时 | 中 | 对接国家药监局数据库，自动月更新，人工补录机制 |
