# P27 光疗晨曦灯——生理节律重塑智能光疗系统

---

## A. 需求分析文档

### 1. 产品概述与定位

**光疗晨曦灯**是一款基于昼夜节律光疗科学设计的智能全光谱台灯，通过模拟日出日落的动态光照曲线、精准控制蓝光/红光比例和光照强度，帮助老年人重塑紊乱的生物钟，改善睡眠质量、缓解季节性情感障碍（SAD）和日落综合征（Sundowning，常见于老年痴呆患者）。配合APP实现个性化光疗处方管理，与睡眠监测（P26）和情绪监测（P22）系统深度联动。

**蓝海点**：光疗（Bright Light Therapy）是治疗睡眠相位提前综合征（老年人最常见睡眠障碍）和SAD的一线循证疗法，有大量RCT支撑；但现有光疗灯均为单一功能、非智能的医疗设备；与生活场景融合的智能版本市场空白。

### 2. 目标用户画像

| 维度 | 描述 |
|------|------|
| 核心用户 | 65–85岁，有睡眠节律紊乱（早醒/夜间多次醒）、季节性情绪低落的老年人 |
| 次要用户 | 老年痴呆患者（日落综合征，下午烦躁不安），长期住院/养老院（缺乏自然光照）老人 |
| 使用场景 | 早晨起床后床头/书桌前，20–30分钟光疗；傍晚温暖光照安抚情绪 |
| 医疗背景 | 睡眠科、精神科、老年科医生推荐 |

### 3. 市场痛点与机会

- 超过50%的老年人有睡眠问题，其中节律紊乱（早醒、白天嗜睡）比例最高
- 安眠药依赖是老年人常见问题，有跌倒风险，非药物光疗是更安全的替代
- 现有光疗灯（Lumie、Philips goLITE）：单一功能，非智能，无节律感知
- 老年痴呆"日落综合征"护理负担极重，光疗是有效干预手段但工具落后
- 智能家居场景融合（台灯+夜灯+节律管理）提供自然的使用动机

### 4. 功能性需求（FR）

**FR-01 光疗核心功能**
- 全光谱LED（色温2,700K–6,500K连续调节，显色指数Ra≥95）
- 光照强度：0–10,000 Lux（标准光疗剂量：10,000 Lux/20–30分钟）
- 蓝光成分精确控制：早晨高蓝光比例（480nm峰值，激活视网膜感光节细胞），傍晚低蓝光
- 光照均匀性：照射面照度均匀性>80%（50cm处）

**FR-02 动态光照曲线**
- 日出模拟：提前20分钟光照从1 Lux渐亮至10,000 Lux（自然唤醒，替代闹钟）
- 日落模拟：傍晚从日光色温缓降至暖光（2,800K，准备睡眠）
- 自定义曲线：根据用户睡眠节律目标，调整曲线斜率和峰值时间

**FR-03 个性化光疗处方**
- 睡眠节律评估：APP问卷（MCTQ慕尼黑时型问卷）+ 与P26睡眠数据联动
- 节律诊断：判断节律类型（提前型/延迟型/正常型）
- 处方生成：
  - 节律提前（早醒）：傍晚光疗（延迟节律）
  - 节律延迟（入睡困难）：早晨光疗（提前节律）
  - SAD/情绪低落：早晨10,000Lux高强度光疗
- 处方执行：自动按处方时间和强度亮灯

**FR-04 日落综合征管理模式**
- 下午3–5点启动暖白光照（3,000K，1,000Lux），稳定情绪，减少烦躁
- 感知模式（可选）：联动P22情绪晴雨表，检测到老人烦躁时自动调整光照
- 护理人员版：多房间统一管理（养老院批量控制模式）

**FR-05 夜间照明安全**
- 智能夜灯模式：感知老人夜间起床（PIR触发），自动亮起极低亮度暖红光（<1Lux，不影响褪黑素分泌）
- 防止黑暗中跌倒（卫生间、走廊路径照明）

**FR-06 健康联动**
- 与P26睡眠护航仪联动：根据昨夜睡眠质量，动态调整今日光疗强度
- 与P22情绪晴雨表联动：情绪评分低时，早晨自动升至最高光疗强度
- 数据反馈：光疗后30分钟内HRV变化记录（评估即时效果）

### 5. 非功能性需求（NFR）

| 维度 | 指标 |
|------|------|
| 最大亮度 | 10,000 Lux（50cm处），达到光疗治疗剂量 |
| 色温范围 | 2,700–6,500K连续可调 |
| 蓝光安全 | 符合IEC 62471光生物安全标准，无危险蓝光 |
| 频闪 | 无可见频闪（频闪指数<0.1），保护老年人敏感视网膜 |
| 响应时间 | 日出模拟渐亮从1Lux到10,000Lux，20分钟线性渐变 |
| 噪声 | 风扇噪声<25dBA（卧室安静环境） |
| 外观 | 优雅台灯设计，不像医疗设备，融入家居 |

### 6. 约束条件与合规要求

- 强度≥2,500Lux设备作为**II类医疗器械**（光疗仪）申报时须临床数据
- 避免直视光源提示（防止视网膜损伤，特别是白内障术后患者）
- 青光眼/视网膜病变患者：须医生评估后使用
- 蓝光安全：符合GB/T 20145光生物安全标准，蓝光危害等级≤RG1

---

## B. 详细设计方案

### 1. 系统架构

```
[光疗晨曦灯（台灯）]
     ├── 全光谱LED阵列（RGB+暖白+冷白，五通道混色）
     ├── 光强传感器（反馈控制）
     ├── PIR传感器（夜间感知）
     ├── 主控MCU（LED PWM驱动+BLE）
     └── WiFi + BLE
          │ WiFi
          ▼
[手机APP]
     ├── 光疗处方管理
     ├── 节律评估问卷
     └── 睡眠/情绪联动
          ▼
[云端服务]
     ├── 节律评估算法
     ├── 光疗效果追踪
     └── 专家处方库
```

### 2. 硬件设计方案

**2.1 LED光源系统**
- LED阵列：5通道（R/G/B/暖白2700K/冷白6500K），各通道独立调光
- 驱动：TI TLC5947（24通道，12bit PWM，恒流驱动，无频闪）
- 光学扩散：PC乳白扩散板（雾度>90%），保证照射面均匀
- 最大光通量：2,500lm，50cm处照度10,000Lux（正面）
- 散热：铝合金灯体自然散热（无风扇方案，绝对静音）

**2.2 传感系统**
- 光照传感器：Vishay VEML7700（感知环境光照，配合自动调节）
- PIR：AM312（检测老人起床动作，触发夜灯）
- 可选：RGB色温传感器（实时校准LED混色效果）

**2.3 主控**
- MCU：ESP32-S3（WiFi+BLE，足够的PWM通道，支持Matter智能家居协议）
- 时钟：RTC（精确时间，按处方准时触发光疗）
- 电源：24V DC适配器，LED驱动效率>90%

**2.4 结构设计**
- 灯臂可调角度（向下15°–45°，适应不同坐姿和距离）
- 底座稳重，防止碰倒（底座直径20cm）
- 外观：简约北欧风，白色+原木色，与家居融合

### 3. 核心算法设计

**3.1 昼夜节律相位计算**
```python
def compute_circadian_phase(sleep_data):
    """基于睡眠数据估算昼夜节律相位"""
    avg_sleep_onset = mean([d.sleep_onset_hour for d in sleep_data[-14:]])
    avg_wake_time = mean([d.wake_time_hour for d in sleep_data[-14:]])
    
    # 正常DLMO（昏暗光线褪黑素分泌开始）约在睡眠前2小时
    dlmo_estimate = avg_sleep_onset - 2.0
    
    # 与标准值对比（标准DLMO约21:00–22:00）
    phase_shift = dlmo_estimate - 21.5  # 正值=延迟，负值=提前
    return phase_shift

def generate_light_prescription(phase_shift):
    """根据节律相位生成光疗处方"""
    if phase_shift < -1.5:  # 提前>1.5小时（早醒型）
        return {
            'type': 'evening_therapy',
            'start_time': '18:00',
            'duration_min': 30,
            'intensity_lux': 5000,
            'color_temp': 5500  # 傍晚高色温抑制褪黑素，延迟节律
        }
    elif phase_shift > 1.5:  # 延迟>1.5小时（晚睡型）
        return {
            'type': 'morning_therapy', 
            'start_time': '07:00',
            'duration_min': 30,
            'intensity_lux': 10000,
            'color_temp': 6500  # 早晨强光提前节律
        }
    else:
        return {'type': 'maintenance', 'intensity_lux': 3000}  # 维持模式
```

**3.2 光照动态曲线生成**
```python
def generate_sunrise_curve(total_minutes=20, target_lux=10000):
    """模拟日出：指数渐亮曲线"""
    t = np.linspace(0, total_minutes, total_minutes*60)
    # 指数函数：开始慢，结尾快（自然日出节律）
    lux_curve = target_lux * (np.exp(t/total_minutes * 3) - 1) / (np.e**3 - 1)
    return lux_curve

def lux_to_pwm(lux_target, led_calibration):
    """将目标照度转换为5通道LED占空比"""
    # 基于标定数据（各通道在不同占空比下的实测照度贡献）求解
    pwm_values = solve_led_mixing(lux_target, led_calibration)
    return pwm_values
```

### 4. 用户交互设计

**首次设置（10分钟）**
```
APP引导：回答5个关于睡眠习惯的问题
→ AI分析：您是节律提前型（典型老年人），建议傍晚光疗
→ 设置处方：每天18:00自动开启30分钟光疗
→ "处方已设置，灯会在每天傍晚自动执行"
```

**日常使用（零操作）**
```
傍晚6点 → 台灯自动亮起（5,000Lux暖白光）
老人坐在台灯前阅读/用餐（正常生活，无特殊姿势要求）
30分钟后 → 自动暗至日常亮度

早晨起床探过PIR → 台灯自动亮起暖红色低亮度夜灯
（无刺激性蓝光，保护褪黑素，安全引导去卫生间）
```

### 5. 商业化路径与技术风险

**商业化路径**
- **定价**：780元（标准台灯版）；1,180元（专业光疗版，含节律评估套件）
- **渠道**：睡眠科/神经科/精神科医院推荐；高端家居渠道；电商
- **B端**：养老院日落综合征管理工具（每间房配置，护理人员统一管控）
- **保险**：非药物睡眠管理工具，医保耗材目录的潜在品类

**技术风险评估**

| 风险 | 等级 | 应对措施 |
|------|------|----------|
| 老年人视网膜敏感，蓝光刺激 | 高 | 严格符合IEC 62471 RG1安全等级，LED选型蓝光峰值<480nm短波成分可控 |
| 光疗效果评估周期长（2–4周才见效） | 中 | 配合睡眠数据客观量化，每周趋势图让用户看到改善 |
| 用户坚持使用意愿低 | 中 | 处方完全自动执行（无需任何操作），融入日常灯具使用场景 |
| 白内障老人（晶体散射蓝光） | 中 | 说明书特别标注，白内障术前患者降低蓝光比例（色温降至4000K） |
